

<div ng-controller="SearchController as vm">
  <form id='search_form' class='form-inline'>
    <div id='search_form_container'></div>
    <div id='search_form_submit_container'>
      <input class='form-control btn-primary' type='button' id='search_submit'
        value='{{ "Tìm kiếm backlog cần chuyển giao" | translate }}'>
      <span style='margin-left: 10px'>{{ "Hiển thị metadata và log?" | translate }}</span>
      <span style='margin-left: 5px'><input id='id_show_metadata_logs' type='checkbox' /></span>
    </div>
  </form>

  <div style='clear:both'></div>
</div>

<div style='clear:both'></div>
<style>
  #minimize-bar li{
    cursor: pointer;
    margin-right: 4px !important;

  }

  .arrangement-class input{
    margin-bottom: 6px !important;
    height: 30px !important;
    line-height: 30px !important;
  }

  

</style>
<div class='facet-box panel panel-body form' ng-controller="FacetController">
  <fieldset>
    <label for='tag-facet'>{{ "Thẻ" | translate }}</label>
    <select ng-model="tag_facet" class='form-control' id='tag-facet'>
      <option value="">{{ "Tất cả" | translate }}</option>
      <option ng-repeat="tag in transfers.tags" value="{{ tag }}">{{ tag }}</option>
    </select>
  </fieldset>

  <ul class='list-inline'>
    <li ng-repeat="facet in Facet.facet_list">
      {{ facet.name }}: {{ facet.text }} <span ng-click="remove_facet(facet.facet, facet.id);"><i
          class="fa fa-times"></i></span>
    </li>
  </ul>
</div>

<!-- <div ng-controller="AlertDisplayController as vm">
  <alert ng-repeat="alert in vm.alert.alerts" type="{{ alert.type }}" close="vm.remove($index)">
    {{ alert.message }}
    <span ng-if="alert.show_spinner"><i class="fa fa-spinner fa-spin"></i></span>
  </alert>
</div> -->

<div ng-controller="AlertDisplayController as vm">
  <alert ng-repeat="alert in vm.alert.alerts" 
         type="{{ alert.type }}" 
         close="vm.remove($index)" 
         ng-style="{
           'position': 'fixed', 
           'top': '20px', 
           'right': '20px', 
           'background-color': alert.type === 'success' ? '#28a745' : (alert.type === 'danger' ? '#dc3545' : '#0066ff'),
           'color': 'white',
           'padding': '10px 20px', 
           'border-radius': '8px', 
           'font-family': 'system-ui, -apple-system, sans-serif', 
           'font-size': '14px', 
           'box-shadow': '0 4px 12px rgba(0, 0, 0, 0.15)', 
           'max-width': '350px', 
           'z-index': '9999', 
           'animation': 'slideIn 0.3s ease-out'
         }">
    {{ alert.message }}
    <span ng-if="alert.show_spinner"><i class="fa fa-spinner fa-spin"></i></span>
  </alert>
</div>

<style>
  @keyframes slideIn {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
</style>



<ui-minimize-bar>

  <ui-minimize-panel title="Kho tạm" open="true" class="transfer-panel">
    <div class='panel panel-default' ng-controller="TreeController">
      <div class='panel-heading'>
        Kho tạm
        <span class="counts">
          <b translate translate-n="(files.selected | filter:{'type': 'transfer'}).length"
            translate-plural="{{$count}} chuyển đổi">1 chuyển đổi</b>,
          <b translate translate-n="files.selected.length" translate-plural="{{$count}} đối tượng đã chọn">1 đối tượng
            đã được chọn</b>
        </span>

        <form ng-submit="submit()" class="form-inline">
          <input type="text" ng-model="tag" ng-disabled="files.selected.length < 1" class="form-control input-sm">
          <input type="submit" id="submit-tag" value="{{ 'Thêm thẻ vào các tệp đã chọn' | translate }}"
            ng-disabled="files.selected.length < 1" class='btn btn-sm btn-default'>
        </form>

        <div class='actions'>
          <input class='btn btn-sm btn-default' type="button" value="{{ 'Bỏ chọn tất cả' | translate }}"
            ng-click="deselect()" ng-disabled="files.selected.length < 1">
          <input class='btn btn-sm btn-default' type="button" value="{{ 'Thu gọn tất cả' | translate }}"
            ng-click="transfers.collapse_all_nodes()">
          <input class='btn btn-sm btn-default' type="button" value="{{ 'Mở tất cả' | translate }}"
            ng-click="transfers.expand_all_nodes()">
        </div>
      </div>
      <div></div>

      <div class="transfer-tree panel-body">
        <treecontrol class="tree-classic" tree-model="transfers.data" options="options"
          on-selection="track_selected(node, selected)" selected-nodes="files.selected"
          filter-expression="filter_expression" filter-comparator="filter_comparator"
          expanded-nodes="transfers.expanded_nodes">
          <span tree-draggable file-type="backlog" uuid="{{ node.id }}" ng-if="!node.not_draggable">
            {{ node.title }} <span class="tag" ng-repeat="tag in node.tags">{{ tag }} <span
                ng-click="remove_tag($event, node.id, tag)"><i
                  class="fa fa-minus-square remove-button"></i></span></span>
          </span>
          <span class="disabled" ng-if="node.not_draggable">
            {{ node.title }} <span class="tag" ng-repeat="tag in node.tags">{{ tag }} <span
                ng-click="remove_tag($event, node.id, tag)"><i
                  class="fa fa-minus-square remove-button"></i></span></span>
          </span>
        </treecontrol>
      </div>
    </div>
  </ui-minimize-panel>

  <ui-minimize-panel title="Phân tích" open='true'>
    <div class='panel panel-default' ng-controller="AnalysisController">
      <div>
        <ul class="nav nav-pills nav-pane" role='menu'>
          <li ng-class="{ active: $routeSegment.contains('objects') }">
            <a href="#{{ $routeSegment.getSegmentUrl('objects') }}">{{ "Đối tượng" | translate }}</a>
          </li>
          <li ng-class="{ active: $routeSegment.contains('tags') }">
            <a href="#{{ $routeSegment.getSegmentUrl('tags') }}">{{ "Thẻ" | translate }}</a>
          </li>
          <li ng-class="{ active: $routeSegment.contains('examine_contents') }">
            <a href="#{{ $routeSegment.getSegmentUrl('examine_contents', {type: ''}) }}">{{ "Kiểm tra nội dung" |
              translate }}</a>
          </li>
          <li ng-class="{ active: $routeSegment.contains('preview') }">
            <a href="#{{ $routeSegment.getSegmentUrl('preview', {id: ''}) }}">{{ "Xem trước tập tin" | translate }}</a>
          </li>
        </ul>
      </div>
      <div class='panel-body' app-view-segment="0"></div>
    </div>
  </ui-minimize-panel>


  <ui-minimize-panel title="{{ 'Danh sách tệp' | translate }}" open='false'>
    <div class='panel panel-default' ng-controller="FileListController as vm">
      <div class='panel-heading'>
        {{ "Danh sách tệp" | translate }}
  
        <span class="counts" ng-if="vm.selected_files.selected.length > 0"><b><ng-pluralize count="(vm.selected_files.selected | filter: {'type': 'file'} | facet).length" when="{'1': '1 object', 'other': '{} objects'}"></ng-pluralize></b> in list, <ng-pluralize count="vm.selected.length" when="{'1': '1 object', 'other': '{} objects'}"></ng-pluralize> selected</span>
  
        <span class="counts" ng-if="vm.selected_files.selected.length === 0">{{ "Danh sách tệp trống." | translate }}</span>
  
        <!--
        <fieldset>
          <label for='start-date-facet'>{{ "Date range start" | translate }}</label>
          <input type="text"
                 ng-model="vm.date_start"
                 class='form-control'
                 id='start-date-facet'
                 ng-change="vm.set_date_filter(vm.date_start, vm.date_end)"
                 ng-pattern="vm.date_regex"/>
          <label for='end-date-facet'>{{ "Date range end" | translate }}</label>
          <input type="text"
                 ng-model="vm.date_end"
                 class='form-control'
                 id='end-date-facet'
                 ng-change="vm.set_date_filter(vm.date_start, vm.date_end)"
                 ng-pattern="vm.date_regex"/>
        </fieldset>
        <span ng-if="vm.date_facet">{{ 'Dates:' | translate }} {{ vm.date_facet }} <span ng-click="vm.reset_dates();"><i class="fa fa-times"></i></span></span>
        -->
  
        <form ng-if="vm.selected_files.selected.length > 0" ng-submit="vm.submit(vm.selected)" class="form-inline">
          <input type="text"
                 class="form-control input-sm"
                 ng-model="vm.tag"
                 ng-disabled="vm.selected.length < 1">
          <input type="submit"
                 id="submit-tag"
                 value="Add tag to selected files"
                 ng-disabled="vm.selected.length < 1"
                 class='btn btn-sm btn-default'>
        </form>
  
        <div class='actions' ng-if="vm.selected_files.selected.length > 0">
          <a class='btn btn-sm btn-default' ng-hide="vm.show_path" ng-click="vm.show_path = !vm.show_path">{{ "Hiển thị đường dẫn" | translate }}</a>
          <a class='btn btn-sm btn-default' ng-show="vm.show_path" ng-click="vm.show_path = !vm.show_path">{{ "Ẩn đường dẫn" | translate }}</a>
        </div>
      </div>
  
      <div class='panel-body'>
        <table ng-if="vm.selected_files.selected.length > 0" class='table table-striped table-hover table-condensed'>
          <tr>
            <th>
              <input type="checkbox"
                     name="checked_files[]"
                     value="Chọn tất cả"
                     ng-checked="vm.all_selected"
                     ng-click="vm.select_all()">
            </th>
  <th><a ng-click="vm.set_sort_property('title')">{{ "Tên tệp" | translate }}</a></th>
            <th ng-if="vm.show_path"><a ng-click="vm.set_sort_property('relative_path')">{{ "Đường dẫn" | translate }}</a></th>
            <th><a ng-click="vm.set_sort_property('size')">{{ "Dung lượng" | translate }}</a></th>
            <th><a ng-click="vm.set_sort_property('last_modified')">{{ "Sửa đổi lần cuối" | translate }}</a></th>
            <th>{{ "Thẻ" | translate }}</th>
          </tr>
          <tr ng-repeat="file in vm.selected_files.selected | facet | filter: {'date': '*'} : vm.facet_filter | filter: {'type': 'file'} | orderBy: vm.sort_property : vm.sort_reverse">
            <td>
              <input checklist
                   type="checkbox"
                   name="checked_files[]"
                   ng-element="file"
                   ng-checked="vm.selected.indexOf(file.id) > -1"
                   record-count="vm.selected_files.selected.length"
                   selected-list="vm.selected"
                   all-selected="vm.all_selected">
            </td>
            <td>
              <a href="#{{ vm.$routeSegment.getSegmentUrl('preview', {id: file.id}) }}">{{ file.title }}</a>
            </td>
            <td ng-if="vm.show_path">{{ file.relative_path }}</td>
            <td>{{ file.size | number }} MB</td>
            <td>{{ file.last_modified }}</td>
            <td>
              <span class="tag" ng-repeat="tag in file.tags">{{ tag }} <span ng-click="vm.remove_tag(file.id, tag)"><i class="fa fa-minus-square remove-button"></i></span></span>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </ui-minimize-panel>

  
 

  <ui-minimize-panel title="{{ 'Không gian Lưu trữ' | translate }}" class="aspace-panel">
    <div class='panel panel-default' ng-controller="ArchivesSpaceController">
      <div class='panel-heading'>
        {{ "Không gian Lưu trữ" | translate }} <span ng-if="loading"><i class="fa fa-spinner fa-spin"></i></span>

      <form ng-submit="load_data({title: title_query, identifier: id_query})" class="form-inline">
        <input type="text" ng-model="title_query" placeholder="{{ 'Tiêu đề' | translate }}" class="form-control input-sm"/>
        <input type="text" ng-model="id_query" placeholder="{{ 'Định danh' | translate }}" class="form-control input-sm"/>
        <input type="submit" class='btn btn-sm btn-primary' id="archivesspace_search" value="{{ 'Tìm kiếm không gian Lưu trữ' | translate }}"/>
      </form>

      <div class="actions">
        <input type='button'
               class='btn btn-primary btn-sm'
               id='add_child_record'
               ng-disabled="!selected"
               ng-click="add_child(selected)"
               value='{{ "Thêm bản ghi con mới" | translate }}'>
        <input type='button'
               class='btn btn-primary btn-sm'
               id='add_child_record'
               ng-disabled="selected.type !== 'resource' &amp;&amp; selected.type !== 'resource_component'"
               ng-click="add_digital_object(selected)"
               value='{{ "Thêm đối tượng số mới" | translate }}'>
        <a class='btn btn-primary btn-sm'
           href="{{ get_rights_url(selected) }}"
           ng-disabled="selected.type !== 'resource' &amp;&amp; selected.type !== 'resource_component'"
           target='_blank'>
          {{ "Chỉnh sửa quyền siêu dữ liệu" | translate }}
        </a>
        <input type='button'
               class='btn btn-primary btn-sm'
               id='edit_record'
               ng-disabled="!selected || selected.request_pending || selected.type === 'digital_object'"
               ng-click="edit(selected)"
               value='{{ "Chỉnh sửa siêu dữ liệu" | translate }}'>
        <input type='button'
               class='btn btn-primary btn-sm'
               id='delete_record'
               ng-disabled="!selected || selected.request_pending"
               ng-confirm-click="{{ 'Are you sure you want to delete this?' | translate }}"
               ng-click="remove(selected)"
               value='{{ "Xóa mục đã chọn" | translate }}'>
        <input type='button'
               class='btn btn-success btn-sm'
               id='finalize_arrange'
               ng-disabled="selected.request_pending || (selected.type !== 'resource' &amp;&amp; selected.type !== 'resource_component')"
               ng-click="finalize_arrangement(selected)"
               value='{{ "Hoàn thiện sắp xếp" | translate }}'>
       </div>
    </div>
    <div class="transfer-tree panel-body">
      <treecontrol id="archivesspace-tree"
             class="tree-light"
tree-model="data"
             options="options"
             selected-node="selected"
             on-node-toggle="on_toggle(node, expanded)"
             expanded-nodes="expanded_nodes">
        <!-- ArchivesSpace record -->
        <span ng-if="node.type === 'resource'" file-type="record">
          <i ng-if="node.has_children" class="fa fa-folder-o"></i>
          <i ng-if="!node.has_children" class="fa fa-file-o"></i>
          {{ node.title }} <span ng-if="node.identifier">({{ node.identifier }})</span>
        </span>
        <span ng-if="node.type === 'resource_component'" file-type="record">
          <i ng-if="node.has_children" class="fa fa-folder-o"></i>
          <i ng-if="!node.has_children" class="fa fa-file-o"></i>
          <span ng-if="node.display_title">{{ node.display_title }}</span>
          <span ng-if="!node.display_title">{{ node.title }}</span>
          <span ng-if="node.identifier">({{ node.identifier }})</span>
        </span>
        <!-- SIP arrange directory -->
        <span ng-if="(node.type === 'arrange_entry') &amp;&amp; node.directory" tree-droppable tree-draggable on-drop="drop" file-type="arrange" file-path="{{ node.path }}">
          <i class="fa fa-folder-o"></i>
          {{ node.title }}
        </span>
        <!-- SIP arrange file -->
        <span ng-if="(node.type === 'arrange_entry') &amp;&amp; !node.directory" tree-draggable file-type="arrange" file-path="{{ node.path }}">
          <i class="fa fa-file-code-o"></i>
          {{ node.title }}
        </span>
        <!-- Digital object -->
        <span ng-if="node.type === 'digital_object'" tree-droppable on-drop="drop" file-type="digital_object">
          <i class="fa fa-barcode"></i>
          {{ node.title }}
        </span>
      </treecontrol>
    </div>
  </div>
</ui-minimize-panel>

  <ui-minimize-panel title="{{ 'Sắp xếp' | translate }}">
    <div class='panel panel-default' ng-controller="ArrangementController as vm">
      <div class='panel-heading'>
        {{ "Sắp xếp" | translate }}
        <div class='facet-box panel-body form'>
          <form ng-submit="vm.create_sip_from_tag()" class="form-inline">
            <fieldset>
              <label for='tag-facet-arrangement'>{{ "Thẻ" | translate }}</label>
              <select ng-model="vm.create_sip_tag" class='form-control' id='tag-facet-arrangement'>
                <option value="">{{ "None" | translate }}</option>
                <option ng-repeat="tag in vm.transfer.tags" value="{{ tag }}">{{ tag }}</option>
              </select>
              <input type="submit" id="arrangement-submit" value="Tạo SIP" ng-disabled="!vm.create_sip_tag"
                class='btn btn-primary'>
            </fieldset>
          </form>
        </div>
      </div>
      <div class="transfer-tree panel-body arrangement-class">
        <input type="button" class="btn btn-primary" id="add_directory" ng-click="vm.create_directory(vm.selected)"
          value="{{ 'Thêm thư mục' | translate }}">
        <input type="button" class="btn btn-primary" id="edit_metadata_arrangement" ng-disabled="!vm.selected"
          ng-click="vm.edit_metadata(vm.selected)" value="{{ 'Chỉnh sửa siêu dữ liệu' | translate }}">
        <input type="button" class="btn btn-primary" id="delete_directory" ng-disabled="!vm.selected"
          ng-confirm-click="{{ 'Are you sure you want to delete this?' | translate }}"
          ng-click="vm.delete_directory(vm.selected)" value="{{ 'Xóa mục đã chọn' | translate }}">
        <input type="button" class="btn btn-primary" id="start_sip_arrangemnt" ng-disabled="!vm.selected"
          ng-click="vm.start_sip(vm.selected)" value="{{ 'Tạo SIP' | translate }}">
        <input type="button" class="btn btn-primary" id="refresh" ng-click="vm.refresh(vm.selected)"
          value="{{ 'Tải lại' | translate }}">
        <treecontrol id="arrangement-tree" class="tree-classic" tree-model="vm.data" options="vm.options"
          selected-node="vm.selected" on-node-toggle="vm.on_toggle(node, expanded)"
          filter-expression="vm.filter_expression" filter-comparator="vm.filter_comparator">
          <!-- New files can only be dragged into directories, not other files -->
          <span tree-draggable tree-droppable file-type="arrange" file-path="/arrange/{{ node.path }}" on-drop="vm.drop"
            ng-if="node.directory">
            {{ node.title }} <span ng-if="node.properties">({{ node.properties.display_string }})</span>
          </span>
          <span tree-draggable file-type="arrange" file-path="{{ node.path }}" ng-if="!node.directory">
            <span>
              {{ node.title }}&nbsp;
              <span ng-if="node.properties.display_string">({{ node.properties.display_string }})</span>
              <span class="tag" ng-repeat="tag in node.properties.tags">
                {{ tag }}&nbsp;
                <span ng-click="vm.remove_tag($event, node, tag)">
                  <i class="fa fa-minus-square remove-button"></i>
                </span>
              </span>
        </treecontrol>
      </div>
    </div>
  </ui-minimize-panel>
</ui-minimize-bar>






